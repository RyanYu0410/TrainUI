<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vertical Route Map – G Line</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            /* Grid & Spacing */
            --baseline: 8px;
            --node-spacing: 80px;
            --label-offset: 16px;
            --icon-gap: 6px;
            
            /* Route Lane */
            --lane-width: 150px;
            --spline-width: 3px;
            
            /* Node Sizes */
            --node-regular: 11px;
            --node-previous: 9px;
            --node-current: 15px;
            --node-terminus: 13px;
            
            /* Colors - Light Theme */
            --bg: #F7F9FB;
            --surface: #FFFFFF;
            --text-primary: #0B0B0D;
            --text-secondary: #3C4650;
            --divider: #E6E9ED;
            
            /* Route Colors (G Line) */
            --route-color: #6CBE45;
            --route-color-fade: rgba(108, 190, 69, 0.5);
            --route-color-strong: rgba(108, 190, 69, 0.9);
            
            /* Status Colors */
            --warning-fill: #FFD166;
            --warning-stroke: #F08A24;
            --flash-a: #000000;
            --flash-b: #FFFFFF;
            
            /* Typography */
            --font-family: 'Inter', 'Helvetica Neue', -apple-system, BlinkMacSystemFont, sans-serif;
            --label-size: 16px;
            --label-weight: 600;
            --label-line-height: 1.35;
        }

        body.dark {
            --bg: #0B0B0D;
            --surface: #1C1F24;
            --text-primary: #FFFFFF;
            --text-secondary: #B9C0C7;
            --divider: #1C1F24;
        }

        body.bw {
            --route-color: #808080;
            --route-color-fade: rgba(128, 128, 128, 0.5);
            --route-color-strong: rgba(128, 128, 128, 0.9);
            --warning-fill: #999999;
            --warning-stroke: #666666;
        }

        body.bw.dark {
            --route-color: #CCCCCC;
            --route-color-fade: rgba(204, 204, 204, 0.5);
            --route-color-strong: rgba(204, 204, 204, 0.9);
        }

        body {
            font-family: var(--font-family);
            background: var(--bg);
            color: var(--text-primary);
            overflow-x: auto;
            overflow-y: auto;
            height: 100vh;
            transition: background 0.3s ease, color 0.3s ease;
        }

        /* STICKY HEADER */
        .header {
            position: sticky;
            top: 0;
            left: 0;
            right: 0;
            height: 64px;
            background: var(--surface);
            border-bottom: 1px solid var(--divider);
            display: flex;
            align-items: center;
            padding: 0 calc(var(--baseline) * 3);
            gap: calc(var(--baseline) * 2);
            z-index: 100;
            transition: background 0.3s ease;
        }

        @keyframes headerFlash {
            0%, 100% { background: #000000; color: #FFFFFF; }
            50% { background: #FFFFFF; color: #000000; }
        }

        .header.flash {
            animation: headerFlash 800ms ease-in-out 3;
        }

        @media (prefers-reduced-motion: reduce) {
            .header.flash {
                animation-iteration-count: 1;
            }
        }

        .route-badge {
            width: 36px;
            height: 36px;
            background: var(--route-color);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 20px;
            color: white;
            flex-shrink: 0;
        }

        .destination {
            font-size: 18px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .current-train-chip {
            background: var(--route-color);
            color: white;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 14px;
            font-weight: 600;
            margin-left: auto;
        }

        .theme-toggles {
            display: flex;
            gap: calc(var(--baseline) * 1);
            flex-shrink: 0;
        }

        .toggle-btn {
            padding: 6px 12px;
            border: 1px solid var(--divider);
            background: transparent;
            color: var(--text-primary);
            border-radius: 6px;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            font-family: var(--font-family);
        }

        .toggle-btn.active {
            background: var(--route-color);
            color: white;
            border-color: var(--route-color);
        }

        .toggle-btn:hover {
            border-color: var(--route-color);
        }

        /* ROUTE CANVAS */
        .route-canvas {
            min-height: 100%;
            padding: calc(var(--baseline) * 6) calc(var(--baseline) * 6);
            padding-bottom: 80px;
            display: flex;
            justify-content: center;
        }

        .route-lane {
            position: relative;
            width: var(--lane-width);
            min-height: max-content;
        }

        /* SVG SPLINE */
        .spline-container {
            position: absolute;
            left: 50%;
            top: 0;
            bottom: 0;
            width: var(--spline-width);
            transform: translateX(-50%);
            overflow: visible;
        }

        .spline-svg {
            width: 100%;
            height: 100%;
            overflow: visible;
        }

        .spline-path {
            fill: none;
            stroke: var(--route-color-strong);
            stroke-width: var(--spline-width);
            opacity: 0.5;
        }

        .spline-fade-start,
        .spline-fade-end {
            opacity: 0.2;
        }

        .spline-dashed {
            stroke-dasharray: 6 4;
        }

        .direction-arrow {
            fill: var(--route-color);
            opacity: 0.6;
        }

        /* NODES */
        .node-container {
            position: absolute;
            left: 50%;
            transform: translate(-50%, -50%);
        }

        .node {
            width: var(--node-regular);
            height: var(--node-regular);
            border-radius: 50%;
            background: var(--route-color);
            position: relative;
        }

        .node.previous {
            width: var(--node-previous);
            height: var(--node-previous);
            background: transparent;
            border: 1.5px solid var(--route-color-fade);
        }

        .node.current {
            width: var(--node-current);
            height: var(--node-current);
            background: var(--route-color);
            border: 2px solid var(--route-color);
            animation: arrivalFlash 800ms ease-in-out 3;
        }

        @keyframes arrivalFlash {
            0%, 100% { background: var(--flash-a); border-color: var(--flash-a); }
            50% { background: var(--flash-b); border-color: var(--flash-b); }
        }

        @media (prefers-reduced-motion: reduce) {
            .node.current {
                animation: arrivalFlash 800ms ease-in-out 1;
            }
        }

        .node.terminus {
            width: var(--node-terminus);
            height: var(--node-terminus);
            border-radius: 2px;
        }

        .node.skipped {
            background: transparent;
            border: 1.5px solid var(--route-color-fade);
            position: relative;
        }

        .node.skipped::after {
            content: '×';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 16px;
            font-weight: 700;
            color: var(--route-color);
            line-height: 1;
        }

        .node.ellipsis {
            width: 12px;
            height: 32px;
            border-radius: 6px;
            background: transparent;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 3px;
        }

        .ellipsis-dot {
            width: 4px;
            height: 4px;
            border-radius: 50%;
            background: var(--route-color-fade);
        }

        /* HILL CONNECTOR */
        .hill-connector {
            position: absolute;
            width: 7px;
            height: 13px;
            border-radius: 50%;
            background: var(--route-color);
            opacity: 0.85;
        }

        .hill-connector.left {
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) translateX(-3.5px);
        }

        .hill-connector.right {
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) translateX(3.5px);
        }

        .hill-connector.ellipsis {
            opacity: 0.4;
            width: 5px;
            height: 10px;
        }

        /* LABELS */
        .station-label {
            position: absolute;
            font-size: var(--label-size);
            font-weight: var(--label-weight);
            line-height: var(--label-line-height);
            color: var(--text-primary);
            white-space: nowrap;
            max-width: 200px;
        }

        .station-label.left {
            right: calc(50% + var(--label-offset));
            top: 50%;
            transform-origin: right center;
            transform: translateY(-50%);
        }

        .station-label.right {
            left: calc(50% + var(--label-offset));
            top: 50%;
            transform-origin: left center;
            transform: translateY(-50%);
        }

        .station-label.terminus {
            font-variant: small-caps;
            font-size: 15px;
            letter-spacing: 0.02em;
        }

        .station-label.skipped {
            text-decoration: line-through;
            opacity: 0.6;
        }

        .ellipsis-count {
            font-size: 13px;
            font-weight: 600;
            color: var(--text-secondary);
            padding: 2px 6px;
            background: var(--surface);
            border-radius: 8px;
            border: 1px solid var(--divider);
            margin-left: 4px;
        }

        /* ICONS & CHIPS */
        .icon-warning {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 18px;
            height: 18px;
            margin-left: var(--icon-gap);
            background: var(--warning-fill);
            border-radius: 3px;
            border: 1px solid var(--warning-stroke);
            font-size: 13px;
            line-height: 1;
            vertical-align: middle;
        }

        .crowd-chip {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            margin-left: var(--icon-gap);
            padding: 2px 8px;
            background: var(--surface);
            border: 1px solid var(--divider);
            border-radius: 10px;
            font-size: 13px;
            font-weight: 600;
            color: var(--text-secondary);
            font-variant-numeric: tabular-nums;
            vertical-align: middle;
        }

        .transfer-badges {
            display: inline-flex;
            gap: 4px;
            margin-left: var(--icon-gap);
            vertical-align: middle;
        }

        .transfer-badge {
            width: 15px;
            height: 15px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 9px;
            font-weight: 700;
            color: white;
        }

        /* MTA Colors */
        .badge-A, .badge-E { background: #0039A6; }
        .badge-B, .badge-D { background: #FF6319; }
        .badge-F { background: #FF6319; }
        .badge-7 { background: #B933AD; }
        .badge-L { background: #A7A9AC; }

        /* BOTTOM STATUS STRIP */
        .status-strip {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            height: 48px;
            background: var(--surface);
            border-top: 1px solid var(--divider);
            display: flex;
            align-items: center;
            padding: 0 calc(var(--baseline) * 3);
            gap: calc(var(--baseline) * 3);
            font-size: 13px;
            color: var(--text-secondary);
            font-weight: 500;
            z-index: 100;
            font-variant-numeric: tabular-nums;
        }

        .status-item {
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .status-separator {
            width: 1px;
            height: 16px;
            background: var(--divider);
        }

        /* RESPONSIVE */
        @media (max-width: 1024px) {
            .route-canvas {
                padding: calc(var(--baseline) * 4);
            }
            :root {
                --node-spacing: 70px;
            }
        }

        /* FOCUS RINGS */
        .node-container:focus-visible {
            outline: 2px solid var(--route-color);
            outline-offset: 4px;
            border-radius: 50%;
        }
    </style>
</head>
<body class="">
    <!-- STICKY HEADER -->
    <header class="header">
        <div class="route-badge">G</div>
        <div class="destination">Church Av → Court Sq</div>
        <div class="current-train-chip">Train #G-047</div>
        <div class="theme-toggles">
            <button class="toggle-btn active" id="btn-light">Light</button>
            <button class="toggle-btn" id="btn-dark">Dark</button>
            <button class="toggle-btn active" id="btn-color">Color</button>
            <button class="toggle-btn" id="btn-bw">B/W</button>
        </div>
    </header>

    <!-- ROUTE CANVAS -->
    <div class="route-canvas">
        <div class="route-lane" id="route-lane">
            <!-- SVG Spline will be rendered here -->
            <svg class="spline-svg" id="spline-svg" style="position: absolute; left: 50%; transform: translateX(-50%); top: 0; width: 60px; height: 100%; overflow: visible;">
                <defs>
                    <linearGradient id="grad-top" x1="0%" y1="100%" x2="0%" y2="0%">
                        <stop offset="0%" stop-color="var(--route-color-strong)" stop-opacity="0.3" />
                        <stop offset="100%" stop-color="var(--route-color-strong)" stop-opacity="0" />
                    </linearGradient>
                    <linearGradient id="grad-bottom" x1="0%" y1="0%" x2="0%" y2="100%">
                        <stop offset="0%" stop-color="var(--route-color-strong)" stop-opacity="0.3" />
                        <stop offset="100%" stop-color="var(--route-color-strong)" stop-opacity="0" />
                    </linearGradient>
                </defs>
                <g id="spline-baseline"></g>
                <g id="spline-overlays"></g>
                <g id="spline-arrows"></g>
            </svg>

            <!-- Nodes will be positioned here -->
        </div>
    </div>

    <!-- BOTTOM STATUS STRIP -->
    <footer class="status-strip">
        <div class="status-item">Updated 14:46:34</div>
        <div class="status-separator"></div>
        <div class="status-item">Alerts ▲ 3</div>
        <div class="status-separator"></div>
        <div class="status-item">Crowd ≥ 120 ppl</div>
        <div class="status-separator"></div>
        <div class="status-item">Collapsed … 19 stops</div>
        <div class="status-separator"></div>
        <div class="status-item">Feed OK</div>
    </footer>

    <script>
        // Theme Toggle Logic
        const btnLight = document.getElementById('btn-light');
        const btnDark = document.getElementById('btn-dark');
        const btnColor = document.getElementById('btn-color');
        const btnBW = document.getElementById('btn-bw');
        const body = document.body;

        btnLight.addEventListener('click', () => {
            body.classList.remove('dark');
            btnLight.classList.add('active');
            btnDark.classList.remove('active');
        });

        btnDark.addEventListener('click', () => {
            body.classList.add('dark');
            btnDark.classList.add('active');
            btnLight.classList.remove('active');
        });

        btnColor.addEventListener('click', () => {
            body.classList.remove('bw');
            btnColor.classList.add('active');
            btnBW.classList.remove('active');
        });

        btnBW.addEventListener('click', () => {
            body.classList.add('bw');
            btnBW.classList.add('active');
            btnColor.classList.remove('active');
        });

        // Station Data (G Line - Church Av to Court Sq) - Vertical Layout
        const stations = [
            { id: 1, name: 'Church Av', type: 'terminus', state: 'previous', position: 'left', transfers: [] },
            { id: 2, name: 'Beverly Rd', type: 'regular', state: 'previous', position: 'right', transfers: [] },
            { id: 3, name: 'Ellipsis 1', type: 'ellipsis', count: 3, position: 'left' },
            { id: 4, name: 'Smith–9 Sts', type: 'regular', state: 'regular', position: 'right', transfers: ['F'], crowd: 89 },
            { id: 5, name: 'Carroll St', type: 'regular', state: 'regular', position: 'left', transfers: [] },
            { id: 6, name: 'Bergen St', type: 'regular', state: 'current', position: 'right', transfers: [] },
            { id: 7, name: 'Hoyt–Schermerhorn', type: 'regular', state: 'regular', position: 'left', transfers: ['A', 'E'], crowd: 173 },
            { id: 8, name: 'Fulton St', type: 'regular', state: 'regular', position: 'right', transfers: [], delayed: true },
            { id: 9, name: 'Clinton–Washington', type: 'regular', state: 'skipped', position: 'left', transfers: [] },
            { id: 10, name: 'Ellipsis 2', type: 'ellipsis', count: 5, position: 'right' },
            { id: 11, name: 'Greenpoint Av', type: 'regular', state: 'regular', position: 'left', transfers: [] },
            { id: 12, name: 'Nassau Av', type: 'regular', state: 'regular', position: 'right', transfers: [], crowd: 142 },
            { id: 13, name: 'Ellipsis 3', type: 'ellipsis', count: 4, position: 'left' },
            { id: 14, name: 'Court Sq', type: 'terminus', state: 'regular', position: 'right', transfers: ['7', 'E'] }
        ];

        // Render Stations
        const routeLane = document.getElementById('route-lane');
        const nodeSpacing = 80; // px
        let yPosition = 64; // Start padding
        const nodePositions = [];

        stations.forEach((station, index) => {
            const nodeContainer = document.createElement('div');
            nodeContainer.className = 'node-container';
            nodeContainer.style.top = `${yPosition}px`;
            nodeContainer.tabIndex = 0;

            if (station.type === 'ellipsis') {
                // Ellipsis Node
                const ellipsisNode = document.createElement('div');
                ellipsisNode.className = 'node ellipsis';
                ellipsisNode.innerHTML = `
                    <span class="ellipsis-dot"></span>
                    <span class="ellipsis-dot"></span>
                    <span class="ellipsis-dot"></span>
                `;
                nodeContainer.appendChild(ellipsisNode);

                // Hill connector (smaller for ellipsis)
                const hill = document.createElement('div');
                hill.className = `hill-connector ellipsis ${station.position}`;
                nodeContainer.appendChild(hill);

                // Ellipsis count label
                const label = document.createElement('div');
                label.className = `station-label ${station.position}`;
                label.innerHTML = `<span class="ellipsis-count">${station.count}</span>`;
                nodeContainer.appendChild(label);

            } else {
                // Regular Node
                const node = document.createElement('div');
                node.className = `node ${station.type} ${station.state}`;
                nodeContainer.appendChild(node);

                // Hill connector
                const hill = document.createElement('div');
                hill.className = `hill-connector ${station.position}`;
                nodeContainer.appendChild(hill);

                // Station Label
                const label = document.createElement('div');
                label.className = `station-label ${station.position}`;
                if (station.type === 'terminus') label.classList.add('terminus');
                if (station.state === 'skipped') label.classList.add('skipped');

                let labelHTML = station.name;

                // Add delay warning
                if (station.delayed) {
                    labelHTML += `<span class="icon-warning">⚠</span>`;
                }

                // Add crowd chip
                if (station.crowd) {
                    labelHTML += `<span class="crowd-chip">👥 ${station.crowd}</span>`;
                }

                // Add transfers
                if (station.transfers && station.transfers.length > 0) {
                    labelHTML += '<span class="transfer-badges">';
                    station.transfers.forEach(line => {
                        labelHTML += `<span class="transfer-badge badge-${line}">${line}</span>`;
                    });
                    labelHTML += '</span>';
                }

                label.innerHTML = labelHTML;
                nodeContainer.appendChild(label);
            }

            routeLane.appendChild(nodeContainer);
            nodePositions.push(yPosition);
            yPosition += nodeSpacing;
        });

        // Adjust route lane height
        routeLane.style.height = `${yPosition + 64}px`;

        // Draw spline programmatically with fades, near-node ramps, arrows, and dashed skipped segment
        const splineSvg = document.getElementById('spline-svg');
        const baselineGroup = splineSvg.querySelector('#spline-baseline');
        const overlaysGroup = splineSvg.querySelector('#spline-overlays');
        const arrowsGroup = splineSvg.querySelector('#spline-arrows');
        const centerX = 30; // SVG center line

        // Helper to create a vertical line
        function makeLine(y1, y2, opacity, dashed = false) {
            const ln = document.createElementNS('http://www.w3.org/2000/svg', 'line');
            ln.setAttribute('x1', centerX);
            ln.setAttribute('y1', y1);
            ln.setAttribute('x2', centerX);
            ln.setAttribute('y2', y2);
            ln.setAttribute('stroke', getComputedStyle(document.documentElement).getPropertyValue('--route-color-strong') || 'rgba(108,190,69,0.9)');
            ln.setAttribute('stroke-width', 3);
            ln.setAttribute('opacity', opacity);
            if (dashed) ln.setAttribute('stroke-dasharray', '6 4');
            return ln;
        }

        // Baseline segments between consecutive nodes
        for (let i = 1; i < nodePositions.length; i++) {
            const y1 = nodePositions[i - 1];
            const y2 = nodePositions[i];
            const prevIsEllipsis = stations[i - 1]?.type === 'ellipsis';
            const nextIsEllipsis = stations[i]?.type === 'ellipsis';
            const op = (prevIsEllipsis && nextIsEllipsis) ? 0.25 : 0.5; // 20–30% between ellipsis clusters, else 40–50%
            baselineGroup.appendChild(makeLine(y1, y2, op));
        }

        // Near-node bright ramps ±10 px
        nodePositions.forEach(y => {
            overlaysGroup.appendChild(makeLine(y - 10, y + 10, 1));
        });

        // Terminus fades beyond ends (48–64 px)
        const fadeExtent = 60; // px
        const topFade = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
        topFade.setAttribute('x', String(centerX - 1.5));
        topFade.setAttribute('y', String(nodePositions[0] - fadeExtent));
        topFade.setAttribute('width', '3');
        topFade.setAttribute('height', String(fadeExtent));
        topFade.setAttribute('fill', 'url(#grad-top)');
        overlaysGroup.appendChild(topFade);

        const bottomFade = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
        bottomFade.setAttribute('x', String(centerX - 1.5));
        bottomFade.setAttribute('y', String(nodePositions[nodePositions.length - 1]));
        bottomFade.setAttribute('width', '3');
        bottomFade.setAttribute('height', String(fadeExtent));
        bottomFade.setAttribute('fill', 'url(#grad-bottom)');
        overlaysGroup.appendChild(bottomFade);

        // Direction arrows every 400–ish px
        const routeHeight = yPosition + 64;
        for (let ay = 400; ay < routeHeight; ay += 400) {
            const poly = document.createElementNS('http://www.w3.org/2000/svg', 'polygon');
            poly.setAttribute('points', `${centerX},${ay} ${centerX - 4},${ay + 8} ${centerX + 4},${ay + 8}`);
            poly.setAttribute('class', 'direction-arrow');
            arrowsGroup.appendChild(poly);
        }

        // Dashed segment through skipped station (±60 px)
        const skippedIndex = stations.findIndex(s => s.state === 'skipped');
        if (skippedIndex !== -1) {
            const sy = nodePositions[skippedIndex];
            overlaysGroup.appendChild(makeLine(sy - 60, sy + 60, 0.8, true));
        }

        // Header flash when a current station exists
        const hasCurrent = stations.some(s => s.state === 'current');
        if (hasCurrent) {
            document.querySelector('.header')?.classList.add('flash');
        }
    </script>
</body>
</html>
